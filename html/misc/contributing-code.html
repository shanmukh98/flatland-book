
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Writing code</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/custom.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/flatland-logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../book/intro.html">
   Welcome to Flatland
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../book/getting-started/installation.html">
   Installing Flatland
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/getting-started/env.html">
   Flatland Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/getting-started/The_Rail_Environment.html">
   Using
   <code class="docutils literal notranslate">
    <span class="pre">
     RailEnv
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/getting-started/sequential-agent.html">
   Sequential Agent
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../book/env/observations.html">
   Provided Observations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/env/level_generation.html">
   Level Generation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/env/environment_information.html">
   Environment information
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/env/custom_observations.html">
   Custom observations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/env/speed_profiles.html">
   Speed profiles
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../book/env/updates.html">
   Updates
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/env/updates/Agent-Close-Following.html">
     Unordered Close Following
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://flatlandrl-docs.aicrowd.com/flatland.html">
   API Reference
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../book/tuts/or.html">
   Operations Research
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../book/tuts/rl.html">
   Reinforcement Learning
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/tuts/rl/single-agent.html">
     Single agent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/tuts/rl/multi-agent.html">
     Multiple Agents
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Challenges
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../book/challenges/amld2021.html">
   AMLD 2021
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/amld2021/envconfig.html">
     Environment Configurations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/amld2021/eval.html">
     Evaluation Metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/amld2021/first-submission.html">
     Making a Submission
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../book/challenges/neurips2020-challenge.html">
   Neurips 2020
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/neurips2020/envconfig.html">
     Environment Configurations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/neurips2020/eval.html">
     Evaluation Metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/neurips2020/first-submission.html">
     Making a Submission
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/challenges/neurips2020/faq.html">
     FAQs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/challenges/halloffame.html">
   Hall of Fame
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Research
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../book/research/baselines.html">
   RLlib Baselines
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/research/baselines/getting-started.html">
     Getting started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/research/baselines/centralized_critic.html">
     Centralized Critic PPO
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/research/baselines/imitation_learning.html">
     Imitation Learning Training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/research/baselines/global_density_obs.html">
     Global Density Observation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/research/baselines/combined_tree_local_conflict_obs.html">
     Combined Observation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/research/baselines/action_masking_and_skipping.html">
     Frame skipping and action masking
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/research/research-ideas.html">
   Research Ideas
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  FAQ
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../book/faq/env.html">
   Flatland Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/faq/research.html">
   Flatland Research
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../book/misc/external-resources.html">
   Community Projects
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../book/misc/contributing.html">
   Contributing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/misc/contributing-code.html">
     Writing code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../book/misc/contributing-doc.html">
     Writing documentation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../book/misc/credits.html">
   Credits
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/misc/contributing-code.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Writing code
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge-request-guidelines">
     Merge Request Guidelines
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tips">
     Tips
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deploying">
     Deploying
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#technical-guidelines">
     Technical Guidelines
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clean-code">
       Clean Code
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#naming-conventions">
       Naming Conventions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#numpydoc">
       numpydoc
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#accessing-resources">
       Accessing resources
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#type-hints">
       Type Hints
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discouraged-type-alias-with-unnamed-members">
   Discouraged: Type Alias with unnamed members
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#better-use-namedtuple">
   Better: use NamedTuple
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#namedtuple">
     NamedTuple
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#class-attributes">
     Class Attributes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#abstract-base-classes">
     Abstract Base Classes
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#currying">
     Currying
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="writing-code">
<h1>Writing code<a class="headerlink" href="#writing-code" title="Permalink to this headline">¶</a></h1>
<p>Ready to contribute? Here’s how to set up Flatland for local development.</p>
<ol>
<li><p>Clone Flatland locally:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone git@gitlab.aicrowd.com:flatland/flatland.git
</pre></div>
</div>
</li>
<li><p>Install the software dependencies via Anaconda-3 or Miniconda-3. (This assumes you have Anaconda installed by following <a class="reference external" href="https://www.anaconda.com/distribution">these instructions</a>)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>conda install -c conda-forge tox-conda
<span class="gp">$ </span>conda install tox
<span class="gp">$ </span>tox -v --recreate
</pre></div>
</div>
<p>This will create a virtual env you can then use.</p>
<p>These steps are performed if you run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>getting_started/getting_started.bat/.sh
</pre></div>
</div>
<p>from Anaconda prompt.</p>
</li>
<li><p>Create a branch for local development::</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git checkout -b name-of-your-bugfix-or-feature
</pre></div>
</div>
<p>Now you can make your changes locally.</p>
</li>
<li><p>When you’re done making changes, check that your changes pass flake8 and the
tests, including testing other Python versions with tox::</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>flake8 flatland tests examples benchmarks
<span class="gp">$ </span>python setup.py <span class="nb">test</span> or py.test
<span class="gp">$ </span>tox
</pre></div>
</div>
<p>To get flake8 and tox, just pip install them into your virtualenv.</p>
</li>
<li><p>Commit your changes and push your branch to Gitlab::</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git add .
<span class="gp">$ </span>git commit -m <span class="s2">&quot;Addresses #&lt;issue-number&gt; Your detailed description of your changes.&quot;</span>
<span class="gp">$ </span>git push origin name-of-your-bugfix-or-feature
</pre></div>
</div>
</li>
<li><p>Submit a merge request through the Gitlab repository website.</p></li>
</ol>
<div class="section" id="merge-request-guidelines">
<h2>Merge Request Guidelines<a class="headerlink" href="#merge-request-guidelines" title="Permalink to this headline">¶</a></h2>
<p>Before you submit a merge request, check that it meets these guidelines:</p>
<ol class="simple">
<li><p>The merge request should include tests.</p></li>
<li><p>The code must be formatted (PyCharm)</p></li>
<li><p>If the merge request adds functionality, the docs should be updated. Put
your new functionality into a function with a docstring, and add the
feature to the list in README.rst.</p></li>
<li><p>The merge request should work for Python 3.6, 3.7 and for PyPy. Check
https://gitlab.aicrowd.com/flatland/flatland/pipelines
and make sure that the tests pass for all supported Python versions.
We force pipelines to be run successfully for merge requests to be merged.</p></li>
<li><p>Although we cannot enforce it technically, we ask for merge requests to be reviewed by at least one core member
in order to ensure that the Technical Guidelines below are respected and that the code is well tested:</p></li>
</ol>
<p>5.1.  The remarks from the review should be resolved/implemented and communicated using the ‘discussions resolved’:</p>
<p>.. image:: images/DiscussionsResolved.png</p>
<p><img alt="" src="../_images/DiscussionsResolved.png" /></p>
<p>5.2.  When a merge request is merged, source branches should be deleted and commits squashed:</p>
<p><img alt="" src="../_images/SourceBranchSquash.png" /></p>
</div>
<div class="section" id="tips">
<h2>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h2>
<p>To run a subset of tests:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>py.test tests.test_flatland
</pre></div>
</div>
</div>
<div class="section" id="deploying">
<h2>Deploying<a class="headerlink" href="#deploying" title="Permalink to this headline">¶</a></h2>
<p>A reminder for the maintainers on how to deploy.</p>
<p>Make sure all your changes are committed.</p>
<p>Then run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>bumpversion patch <span class="c1"># possible: major / minor / patch</span>
<span class="gp">$ </span>git push
<span class="gp">$ </span>git push --tags
</pre></div>
</div>
</div>
<div class="section" id="technical-guidelines">
<h2>Technical Guidelines<a class="headerlink" href="#technical-guidelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="clean-code">
<h3>Clean Code<a class="headerlink" href="#clean-code" title="Permalink to this headline">¶</a></h3>
<p>Please adhere to the general <code class="docutils literal notranslate"><span class="pre">Clean</span> <span class="pre">Code</span> <span class="pre">&lt;https://www.planetgeek.ch/wp-content/uploads/2014/11/Clean-Code-V2.4.pdf&gt;</span></code>_ principles, for instance we write short and concise functions and use appropriate naming to ensure readability.</p>
</div>
<div class="section" id="naming-conventions">
<h3>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h3>
<p>We use the pylint naming conventions:</p>
<p><code class="docutils literal notranslate"><span class="pre">module_name</span></code>, <code class="docutils literal notranslate"><span class="pre">package_name</span></code>, <code class="docutils literal notranslate"><span class="pre">ClassName</span></code>, <code class="docutils literal notranslate"><span class="pre">method_name</span></code>, <code class="docutils literal notranslate"><span class="pre">ExceptionName</span></code>, <code class="docutils literal notranslate"><span class="pre">function_name</span></code>, <code class="docutils literal notranslate"><span class="pre">GLOBAL_CONSTANT_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">global_var_name</span></code>, <code class="docutils literal notranslate"><span class="pre">instance_var_name</span></code>, <code class="docutils literal notranslate"><span class="pre">function_parameter_name</span></code>, <code class="docutils literal notranslate"><span class="pre">local_var_name</span></code>.</p>
</div>
<div class="section" id="numpydoc">
<h3>numpydoc<a class="headerlink" href="#numpydoc" title="Permalink to this headline">¶</a></h3>
<p>Docstrings should be formatted using <a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html">numpydoc</a>.</p>
</div>
<div class="section" id="accessing-resources">
<h3>Accessing resources<a class="headerlink" href="#accessing-resources" title="Permalink to this headline">¶</a></h3>
<p>We use <code class="docutils literal notranslate"><span class="pre">importlib-resources</span> <span class="pre">&lt;https://importlib-resources.readthedocs.io/en/latest/&gt;</span></code>_ to read from local files.
Sample usages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">importlib_resources</span> <span class="kn">import</span> <span class="n">path</span>

<span class="k">with</span> <span class="n">path</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_in</span><span class="p">:</span>
    <span class="n">new_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_in</span><span class="p">)</span>
</pre></div>
</div>
<p>And:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">importlib_resources</span> <span class="kn">import</span> <span class="n">read_binary</span>

<span class="n">load_data</span> <span class="o">=</span> <span class="n">read_binary</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">set_full_state_msg</span><span class="p">(</span><span class="n">load_data</span><span class="p">)</span>
</pre></div>
</div>
<p>Renders the scene into a image (screenshot)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">renderer</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span><span class="s2">&quot;filename.bmp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="type-hints">
<h3>Type Hints<a class="headerlink" href="#type-hints" title="Permalink to this headline">¶</a></h3>
<p>We use Type Hints (<a class="reference external" href="https://www.python.org/dev/peps/pep-0484/">PEP 484</a>) for better readability and better IDE support.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is how you declare the type of a variable type in Python 3.6</span>
<span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># In Python 3.5 and earlier you can use a type comment instead</span>
<span class="c1"># (equivalent to the previous definition)</span>
<span class="n">age</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># type: int</span>

<span class="c1"># You don&#39;t need to initialize a variable to annotate it</span>
<span class="n">a</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Ok (no value at runtime until assigned)</span>

<span class="c1"># The latter is useful in conditional branches</span>
<span class="n">child</span><span class="p">:</span> <span class="nb">bool</span>
<span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
    <span class="n">child</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">child</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Have a look at the <a class="reference external" href="https://mypy.readthedocs.io/en/latest/cheat_sheet_py3.html">Type Hints Cheat Sheet</a> to get started with Type Hints.</p>
<p>Caveat: We discourage the usage of Type Aliases for structured data since its members remain unnamed (see <a class="reference external" href="https://gitlab.aicrowd.com/flatland/flatland/issues/284/">Issue #284</a>).</p>
</div>
</div>
</div>
<div class="section" id="discouraged-type-alias-with-unnamed-members">
<h1>Discouraged: Type Alias with unnamed members<a class="headerlink" href="#discouraged-type-alias-with-unnamed-members" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="better-use-namedtuple">
<h1>Better: use NamedTuple<a class="headerlink" href="#better-use-namedtuple" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="n">Position</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;Position&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="section" id="namedtuple">
<h2>NamedTuple<a class="headerlink" href="#namedtuple" title="Permalink to this headline">¶</a></h2>
<p>For structured data containers for which we do not write additional methods, we use
<code class="docutils literal notranslate"><span class="pre">NamedTuple</span></code> instead of plain <code class="docutils literal notranslate"><span class="pre">Dict</span></code> to ensure better readability by</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="n">RailEnvNextAction</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;RailEnvNextAction&#39;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="n">RailEnvActions</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;next_position&#39;</span><span class="p">,</span> <span class="n">RailEnvGridPos</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;next_direction&#39;</span><span class="p">,</span> <span class="n">Grid4TransitionsEnum</span><span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>Members of NamedTuple can then be accessed through <code class="docutils literal notranslate"><span class="pre">.&lt;member&gt;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">['&lt;key&gt;']</span></code>.</p>
<p>If we have to ensure some (class) invariant over multiple members
(for instance, <code class="docutils literal notranslate"><span class="pre">o.A</span></code> always changes at the same time as <code class="docutils literal notranslate"><span class="pre">o.B</span></code>),
then we should uses classes instead, see the next section.</p>
</div>
<div class="section" id="class-attributes">
<h2>Class Attributes<a class="headerlink" href="#class-attributes" title="Permalink to this headline">¶</a></h2>
<p>We use classes for data structures if we need to write methods that ensure (class) invariants over multiple members,
for instance, <code class="docutils literal notranslate"><span class="pre">o.A</span></code> always changes at the same time as <code class="docutils literal notranslate"><span class="pre">o.B</span></code>.
We use the <a class="reference external" href="https://github.com/python-attrs/attrs">attrs class decorator</a> and a way to declaratively define the attributes on that class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@attrs</span>
<span class="k">class</span> <span class="nc">Replay</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">attrib</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="abstract-base-classes">
<h2>Abstract Base Classes<a class="headerlink" href="#abstract-base-classes" title="Permalink to this headline">¶</a></h2>
<p>We use the <a class="reference external" href="https://pymotw.com/3/abc/">abc class decorator</a> and a way to declaratively define the attributes on that class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">abc</span>

<span class="k">class</span> <span class="nc">PluginBase</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve data from the input source</span>
<span class="sd">        and return an object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the data object to the output.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>And then</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># abc_subclass.py</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">from</span> <span class="nn">abc_base</span> <span class="kn">import</span> <span class="n">PluginBase</span>

<span class="k">class</span> <span class="nc">SubclassImplementation</span><span class="p">(</span><span class="n">PluginBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Subclass:&#39;</span><span class="p">,</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">SubclassImplementation</span><span class="p">,</span>
                                  <span class="n">PluginBase</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Instance:&#39;</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SubclassImplementation</span><span class="p">(),</span>
                                  <span class="n">PluginBase</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="currying">
<h2>Currying<a class="headerlink" href="#currying" title="Permalink to this headline">¶</a></h2>
<p>We discourage currying to encapsulate state since we often want the stateful object to have multiple methods
(but the curried function has only its signature and abusing params to switch behaviour is not very readable).</p>
<p>Thus, we should refactor our generators and use classes instead (see <a class="reference external" href="https://gitlab.aicrowd.com/flatland/flatland/issues/283">Issue #283</a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Type Alias</span>
<span class="n">RailGeneratorProduct</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">GridTransitionMap</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]</span>
<span class="n">RailGenerator</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">RailGeneratorProduct</span><span class="p">]</span>

<span class="c1"># Currying: a function that returns a confectioned function with internal state</span>
<span class="k">def</span> <span class="nf">complex_rail_generator</span><span class="p">(</span><span class="n">nr_start_goal</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">nr_extra</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                           <span class="n">min_dist</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                           <span class="n">max_dist</span><span class="o">=</span><span class="mi">99999</span><span class="p">,</span>
                           <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RailGenerator</span><span class="p">:</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Flatland Community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-132885496-4', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>